{"title":"「BZOJ1935」[SHOI2007]园丁的烦恼","date":"2018-03-08T06:00:48.000Z","excerpt":"","slug":"「BZOJ1935」-SHOI2007-园丁的烦恼","updated":"2018-07-17T15:22:24.813Z","content":"<h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>给$n$个点的坐标，有$m$次询问，询问某一个矩阵内有多少个点。(0≤n≤500000,1≤m≤500000)</p>\n<h2 id=\"解析\"><a href=\"#解析\" class=\"headerlink\" title=\"解析\"></a>解析</h2><p>经典的二维偏序问题。</p>\n<p>我也不知道为什么当时脑抽以为是三维偏序的。</p>\n<p>其实一发树状数组就可以水过啦。</p>\n<p>但由于我当时很脑抽，写了CDQ分治。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;bits/stdc++.h&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> N=<span class=\"number\">500010</span>,K=<span class=\"number\">10000010</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> n,m,maxy,totq,ans[N];</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">int</span> <span class=\"title\">read</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x=<span class=\"number\">0</span>,w=<span class=\"number\">1</span>;<span class=\"keyword\">char</span> c=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(c&lt;<span class=\"string\">'0'</span>||c&gt;<span class=\"string\">'9'</span>)&#123;<span class=\"keyword\">if</span>(c==<span class=\"string\">'-'</span>) w=<span class=\"number\">-1</span>;c=getchar();&#125;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(c&gt;=<span class=\"string\">'0'</span>&amp;&amp;c&lt;=<span class=\"string\">'9'</span>) x=(x&lt;&lt;<span class=\"number\">3</span>)+(x&lt;&lt;<span class=\"number\">1</span>)+c-<span class=\"string\">'0'</span>,c=getchar();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x*w;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Node</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> type,x,y,v;</span><br><span class=\"line\">    <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&lt;(<span class=\"keyword\">const</span> Node&amp; k)<span class=\"keyword\">const</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x==k.x&amp;&amp;y==k.y) <span class=\"keyword\">return</span> type&lt;k.type;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(y==k.y) <span class=\"keyword\">return</span> x&lt;k.x;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> y&lt;k.y;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;que[N*<span class=\"number\">5</span>],temp[N*<span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">cmp</span><span class=\"params\">(<span class=\"keyword\">const</span> Node&amp; x,<span class=\"keyword\">const</span> Node&amp; y)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x.x==y.x&amp;&amp;x.y==y.y) <span class=\"keyword\">return</span> x.type&lt;y.type;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x.x==y.x) <span class=\"keyword\">return</span> x.y&lt;y.y;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x.x&lt;y.x;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">cdq</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(l&gt;=r) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">    cdq(l,mid);cdq(mid+<span class=\"number\">1</span>,r);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> pi=l,pj=mid+<span class=\"number\">1</span>,pt=l,sum=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(pi&lt;=mid&amp;&amp;pj&lt;=r)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(que[pi]&lt;que[pj])&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(que[pi].type==<span class=\"number\">1</span>) sum++;</span><br><span class=\"line\">            temp[pt++]=que[pi++];</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(que[pj].type&gt;<span class=\"number\">1</span>) ans[que[pj].v]+=(que[pj].type==<span class=\"number\">2</span>?<span class=\"number\">1</span>:<span class=\"number\">-1</span>)*sum;</span><br><span class=\"line\">            temp[pt++]=que[pj++];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(pi&lt;=mid) temp[pt++]=que[pi++];</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(pj&lt;=r)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(que[pj].type&gt;<span class=\"number\">1</span>) ans[que[pj].v]+=(que[pj].type==<span class=\"number\">2</span>?<span class=\"number\">1</span>:<span class=\"number\">-1</span>)*sum;</span><br><span class=\"line\">        temp[pt++]=que[pj++];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=l;i&lt;=r;i++) que[i]=temp[i];</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> t1,t2,t3,t4;</span><br><span class=\"line\">    n=read(),m=read();</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++)&#123;</span><br><span class=\"line\">        t1=read(),t2=read(),t1++,t2++,maxy=max(maxy,t2);</span><br><span class=\"line\">        que[++totq]=(Node)&#123;<span class=\"number\">1</span>,t1,t2,<span class=\"number\">1</span>&#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;i++)&#123;</span><br><span class=\"line\">        t1=read(),t2=read(),t3=read(),t4=read();</span><br><span class=\"line\">        t1++,t2++,t3++,t4++;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(t2&gt;<span class=\"number\">1e7</span>+<span class=\"number\">1</span>||t1&gt;<span class=\"number\">1e7</span>+<span class=\"number\">1</span>||t3&lt;<span class=\"number\">1</span>||t4&lt;<span class=\"number\">1</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        t1=max(t1,<span class=\"number\">1</span>);t2=max(t2,<span class=\"number\">1</span>);</span><br><span class=\"line\">        t3=min(t3,<span class=\"keyword\">int</span>(<span class=\"number\">1e7</span>)+<span class=\"number\">1</span>);</span><br><span class=\"line\">        t4=min(t4,<span class=\"keyword\">int</span>(<span class=\"number\">1e7</span>)+<span class=\"number\">1</span>);</span><br><span class=\"line\">        maxy=max(maxy,max(t2,t4));</span><br><span class=\"line\">        que[++totq]=(Node)&#123;<span class=\"number\">2</span>,t3,t4,i&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(t1&gt;<span class=\"number\">1</span>&amp;&amp;t2&gt;<span class=\"number\">1</span>) que[++totq]=(Node)&#123;<span class=\"number\">2</span>,t1<span class=\"number\">-1</span>,t2<span class=\"number\">-1</span>,i&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(t2&gt;<span class=\"number\">1</span>) que[++totq]=(Node)&#123;<span class=\"number\">3</span>,t3,t2<span class=\"number\">-1</span>,i&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(t1&gt;<span class=\"number\">1</span>) que[++totq]=(Node)&#123;<span class=\"number\">3</span>,t1<span class=\"number\">-1</span>,t4,i&#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sort(que+<span class=\"number\">1</span>,que+totq+<span class=\"number\">1</span>,cmp);</span><br><span class=\"line\">    cdq(<span class=\"number\">1</span>,totq);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;i++) <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>,ans[i]);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","prev":{"title":"「BZOJ1834」[ZJOI2010]网络扩容","slug":"「BZOJ1834」-ZJOI2010-网络扩容"},"next":{"title":"【BZOJ3262】陌上花开","slug":"【BZOJ3262】陌上花开"},"link":"/2018/03/08","toc":[{"title":"题目大意","id":"题目大意","index":"1"},{"title":"解析","id":"解析","index":"2"},{"title":"代码","id":"代码","index":"3"}]}