{"title":"「luogu2664」树上游戏","date":"2018-03-08T05:54:29.000Z","excerpt":"","slug":"「luogu2664」树上游戏","updated":"2018-07-17T15:14:31.201Z","content":"<h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>给一棵树，树的每个节点有个颜色。定义$s(i,j)$为$i$到$j$的颜色数量，以及</p>\n<script type=\"math/tex; mode=display\">sum_i=\\sum_{j=1}^{n} s(i,j)</script><p>求所有的$sum[i]$。</p>\n<h2 id=\"解析\"><a href=\"#解析\" class=\"headerlink\" title=\"解析\"></a>解析</h2><h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;bits/stdc++.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> ll long long</span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> N=<span class=\"number\">100010</span>,oo=INT_MAX;</span><br><span class=\"line\"><span class=\"keyword\">int</span> n,color[N],cnt[N],cnt2[N],sub[N],nowchild;</span><br><span class=\"line\">ll sum[N];</span><br><span class=\"line\"><span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt;g[N];</span><br><span class=\"line\"><span class=\"keyword\">int</span> f[N],siz[N],root,tot_node,sumsiz[N],cursumsiz[N];</span><br><span class=\"line\"><span class=\"keyword\">int</span> timer,timer2,colorvis[N],curcolorvis[N],isfirst[N];</span><br><span class=\"line\"><span class=\"keyword\">bool</span> vis[N];</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">getroot</span><span class=\"params\">(<span class=\"keyword\">int</span> k,<span class=\"keyword\">int</span> fa)</span></span>&#123;</span><br><span class=\"line\">    siz[k]=<span class=\"number\">1</span>,f[k]=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;g[k].size();i++)&#123;</span><br><span class=\"line\">        x=g[k][i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x==fa||vis[x]) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        getroot(x,k);</span><br><span class=\"line\">        siz[k]+=siz[x],f[k]=max(f[k],siz[x]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    f[k]=max(f[k],tot_node-siz[k]);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(f[root]&gt;f[k]) root=k;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">dfs0</span><span class=\"params\">(<span class=\"keyword\">int</span> k,<span class=\"keyword\">int</span> fa)</span></span>&#123;</span><br><span class=\"line\">    siz[k]=<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;g[k].size();i++)&#123;</span><br><span class=\"line\">        x=g[k][i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x==fa||vis[x]) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        dfs0(x,k);</span><br><span class=\"line\">        siz[k]+=siz[x];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">getsum</span><span class=\"params\">(<span class=\"keyword\">int</span> k,<span class=\"keyword\">int</span> fa)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(cnt[color[k]]==<span class=\"number\">1</span>&amp;&amp;fa)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(colorvis[color[k]]!=timer) colorvis[color[k]]=timer,sumsiz[color[k]]=<span class=\"number\">0</span>;</span><br><span class=\"line\">        sumsiz[color[k]]+=siz[k];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;g[k].size();i++)&#123;</span><br><span class=\"line\">        x=g[k][i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x==fa||vis[x]) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        cnt[color[x]]++;</span><br><span class=\"line\">        getsum(x,k);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    cnt[color[k]]--;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">fix</span><span class=\"params\">(<span class=\"keyword\">int</span> k,<span class=\"keyword\">int</span> fa)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(isfirst[k]==timer)&#123;</span><br><span class=\"line\">        sub[k]-=sumsiz[color[k]]-cursumsiz[color[k]];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;g[k].size();i++)&#123;</span><br><span class=\"line\">        x=g[k][i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x==fa||vis[x]) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        fix(x,k);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">dfs1</span><span class=\"params\">(<span class=\"keyword\">int</span> k,<span class=\"keyword\">int</span> fa,<span class=\"keyword\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(cnt[color[k]]==<span class=\"number\">1</span>&amp;&amp;fa)&#123;</span><br><span class=\"line\">        isfirst[k]=timer;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(curcolorvis[color[k]]!=timer2) curcolorvis[color[k]]=timer2,cursumsiz[color[k]]=<span class=\"number\">0</span>;</span><br><span class=\"line\">        sub[k]+=tot_node-siz[nowchild],sub[r]+=siz[k],sub[nowchild]-=siz[k];</span><br><span class=\"line\">        cursumsiz[color[k]]+=siz[k];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;g[k].size();i++)&#123;</span><br><span class=\"line\">        x=g[k][i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x==fa||vis[x]) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!fa) nowchild=x,timer2++;</span><br><span class=\"line\">        cnt[color[x]]++;</span><br><span class=\"line\">        dfs1(x,k,r);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!fa) fix(x,k);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    cnt[color[k]]--;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">dfs2</span><span class=\"params\">(<span class=\"keyword\">int</span> k,<span class=\"keyword\">int</span> fa)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">    sum[k]+=sub[k];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;g[k].size();i++)&#123;</span><br><span class=\"line\">        x=g[k][i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x==fa||vis[x]) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        sub[x]+=sub[k];</span><br><span class=\"line\">        dfs2(x,k);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sub[k]=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">calc</span><span class=\"params\">(<span class=\"keyword\">int</span> k)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">    timer++;</span><br><span class=\"line\">    dfs0(k,<span class=\"number\">0</span>);</span><br><span class=\"line\">    cnt[color[k]]++;</span><br><span class=\"line\">    getsum(k,<span class=\"number\">0</span>);</span><br><span class=\"line\">    cnt[color[k]]++;</span><br><span class=\"line\">    dfs1(k,<span class=\"number\">0</span>,k);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;g[k].size();i++)&#123;</span><br><span class=\"line\">        x=g[k][i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(vis[x]) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        sub[x]+=tot_node-siz[x];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sum[k]+=tot_node;</span><br><span class=\"line\">    dfs2(k,<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">work</span><span class=\"params\">(<span class=\"keyword\">int</span> k)</span></span>&#123;</span><br><span class=\"line\">    vis[k]=<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">    calc(k);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;g[k].size();i++)&#123;</span><br><span class=\"line\">        x=g[k][i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(vis[x]) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        root=<span class=\"number\">0</span>,tot_node=siz[x];</span><br><span class=\"line\">        getroot(x,<span class=\"number\">0</span>);</span><br><span class=\"line\">        work(root);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> t1,t2;</span><br><span class=\"line\">    f[<span class=\"number\">0</span>]=oo;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>,&amp;n);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++) <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>,&amp;color[i]);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;n;i++)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>,&amp;t1,&amp;t2);</span><br><span class=\"line\">        g[t1].push_back(t2);g[t2].push_back(t1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    root=<span class=\"number\">0</span>,tot_node=n;</span><br><span class=\"line\">    getroot(<span class=\"number\">1</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">    work(root);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++)<span class=\"built_in\">printf</span>(<span class=\"string\">\"%lld\\n\"</span>,sum[i]);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","prev":{"title":"【BZOJ3262】陌上花开","slug":"【BZOJ3262】陌上花开"},"next":{"title":"「BZOJ2152」聪聪可可","slug":"「BZOJ2152」聪聪可可"},"link":"/2018/03/08","toc":[{"title":"题目大意","id":"题目大意","index":"1"},{"title":"代码","id":"代码","index":"2"}]}