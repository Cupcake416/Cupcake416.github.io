{"title":"「BZOJ2120」数颜色","date":"2018-03-08T08:55:54.000Z","excerpt":"","slug":"「BZOJ2120」数颜色","updated":"2018-07-18T16:00:14.381Z","content":"<h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>墨墨购买了一套$N$支彩色画笔（其中有些颜色可能相同），摆成一排，你需要回答墨墨的提问。墨墨会像你发布如下指令：<br>1、 Q L R 代表询问你从第$L$支画笔到第$R$支画笔中共有几种不同颜色的画笔。<br>2、 R P Col 把第$P$支画笔替换为颜色$Col$。</p>\n<h2 id=\"解析\"><a href=\"#解析\" class=\"headerlink\" title=\"解析\"></a>解析</h2><p>如果没有修改，我们可以通过区间[L,R]的答案快速求出区间[L-1,R],[L+1,R],[L,R-1],[L,R+1]的答案。</p>\n<p>事实上，我们也可以O(1)的转移出修改前后的答案，即当我们知道[L,R,T]时，可以快速求出[L,R,T-1]和[L,R,T+1]。([L,R,T]表示第T次修改后区间[L,R]的答案)</p>\n<p>这就相当于普通莫队多了一维。</p>\n<p>具体可以这么实现:<br>(1) 把序列分为$n^{\\frac{2}{3}}$个块，记$bel[i]$为$i$所在的块。<br>(2) 把询问的区间以$bel[l]$为第一关键字，$bel[r]$为第二关键字排序,t为第三关键字排序。<br>(3) 按排序后的顺序计算出答案即可。<br>*(4) 调参。</p>\n<p>这个算法有个名字叫带修改莫队。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;bits/stdc++.h&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> N=<span class=\"number\">10010</span>,C=<span class=\"number\">1000010</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> n,m,siz,bel[N],color[N],temp[N],pos[N],from[N],to[N],cnt[C],totc,totq,ans[N];</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Q</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> l,r,t,id;<span class=\"comment\">//查询[l,r]在t次修改后的信息 </span></span><br><span class=\"line\">    <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&lt;(<span class=\"keyword\">const</span> Q&amp; k)<span class=\"keyword\">const</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(bel[l]==bel[k.l]&amp;&amp;bel[r]==bel[k.r]) <span class=\"keyword\">return</span> t&lt;k.t;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(bel[l]==bel[k.l]) <span class=\"keyword\">return</span> r&lt;k.r;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> l&lt;k.l;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;que[N];</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> opt[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">int</span> t1,t2;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>,&amp;n,&amp;m);</span><br><span class=\"line\">    siz=<span class=\"built_in\">pow</span>(n,<span class=\"number\">2.0</span>/<span class=\"number\">3</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++) <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>,&amp;color[i]),temp[i]=color[i],bel[i]=i/siz+<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;i++)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%s%d%d\"</span>,opt,&amp;t1,&amp;t2);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(opt[<span class=\"number\">0</span>]==<span class=\"string\">'Q'</span>) que[++totq]=(Q)&#123;t1,t2,totc,totq&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> totc++,pos[totc]=t1,to[totc]=t2,from[totc]=temp[t1],temp[t1]=t2;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sort(que+<span class=\"number\">1</span>,que+totq+<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> pl=<span class=\"number\">1</span>,pr=<span class=\"number\">0</span>,pt=<span class=\"number\">0</span>,res=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=totq;i++)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(pl&gt;que[i].l)&#123;</span><br><span class=\"line\">            pl--;</span><br><span class=\"line\">            cnt[color[pl]]++;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(cnt[color[pl]==<span class=\"number\">1</span>]) res++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(pr&lt;que[i].r)&#123;</span><br><span class=\"line\">            pr++;</span><br><span class=\"line\">            cnt[color[pr]]++;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(cnt[color[pr]]==<span class=\"number\">1</span>) res++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(pt&lt;que[i].t)&#123;</span><br><span class=\"line\">            pt++;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(pos[pt]&lt;=pr&amp;&amp;pos[pt]&gt;=pl)&#123;</span><br><span class=\"line\">                cnt[color[pos[pt]]]--;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(!cnt[color[pos[pt]]]) res--;</span><br><span class=\"line\">            &#125; </span><br><span class=\"line\">            color[pos[pt]]=to[pt];</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(pos[pt]&lt;=pr&amp;&amp;pos[pt]&gt;=pl)&#123;</span><br><span class=\"line\">                cnt[color[pos[pt]]]++;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(cnt[color[pos[pt]]]==<span class=\"number\">1</span>) res++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(pt&gt;que[i].t)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(pos[pt]&lt;=pr&amp;&amp;pos[pt]&gt;=pl)&#123;</span><br><span class=\"line\">                cnt[color[pos[pt]]]--;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(!cnt[color[pos[pt]]]) res--;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            color[pos[pt]]=from[pt];</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(pos[pt]&lt;=pr&amp;&amp;pos[pt]&gt;=pl)&#123;</span><br><span class=\"line\">                cnt[color[pos[pt]]]++;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(cnt[color[pos[pt]]]==<span class=\"number\">1</span>) res++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            pt--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(pl&lt;que[i].l)&#123;</span><br><span class=\"line\">            cnt[color[pl]]--;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!cnt[color[pl]]) res--;</span><br><span class=\"line\">            pl++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(pr&gt;que[i].r)&#123;</span><br><span class=\"line\">            cnt[color[pr]]--;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!cnt[color[pr]]) res--;</span><br><span class=\"line\">            pr--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ans[que[i].id]=res;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=totq;i++) <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>,ans[i]);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","prev":{"title":"「UOJ58」[WC2013]糖果公园","slug":"「UOJ58」-WC2013-糖果公园"},"next":{"title":"「BZOJ2038」小Z的袜子","slug":"「BZOJ2038」小Z的袜子"},"link":"/2018/03/08","toc":[{"title":"题目大意","id":"题目大意","index":"1"},{"title":"解析","id":"解析","index":"2"},{"title":"代码","id":"代码","index":"3"}]}